<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <!-- JQuery JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <!-- Bootstrap Toggle CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap5-toggle@5.0.4/css/bootstrap5-toggle.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../../../static/css/style.css" />
    <link rel="stylesheet" href="../../../static/css/toggle.css" />
    <title>Hello World</title>
  </head>
  <body>
    <div id="navbar_section"></div>

    <form class="needs-validation" action="static/html/success.html" novalidate>
      <div id="hello_section"></div>
      <div id="guests_section"></div>
      <div id="details_section"></div>
      <div id="send_section"></div>
    </form>
    <!-- Bootstrap JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
    <!-- Bootstrap Toggle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap5-toggle@5.0.4/js/bootstrap5-toggle.ecmas.min.js"></script>
    <script>
      $(function () {
        $("#navbar_section").load("static/html/navbar_section.html");
        $("#hello_section").load("static/html/hello_section.html");
        $("#guests_section").load("static/html/guests_section.html");
        $("#details_section").load("static/html/details_section.html");
        $("#send_section").load("static/html/send_section.html");
      });
      $(document).ready(function () {
        const observer = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add("show");
            } else {
              entry.target.classList.remove("show");
            }
          });
        });

        const hiddenElements = document.querySelectorAll(".hidden");
        hiddenElements.forEach((element) => {
          observer.observe(element);
        });
      });
      // Example starter JavaScript for disabling form submissions if there are invalid fields
      (function () {
        //
        // $.ajax({
        //   type: "POST",
        //   url: "submit_form",
        //   data: { name: $("#name_input").val(), key_2: "value" },
        //   success: function (response) {
        //     console.log(response);
        //   },
        // });
        // //
        // ("use strict");

        // Fetch all the forms we want to apply custom Bootstrap validation styles to
        var forms = document.querySelectorAll(".needs-validation");

        // Loop over them and prevent submission
        Array.prototype.slice.call(forms).forEach(function (form) {
          form.addEventListener(
            "submit",
            function (event) {
              var name_arr = $("input[id=guest_name_input]")
                .map(function () {
                  return this.value;
                })
                .get();
              console.log(name_arr);

              var age_arr = $("select[id=guest_age_input]")
                .map(function () {
                  return this.value;
                })
                .get();
              console.log(age_arr);

              const guests = [];
              name_arr.forEach((name, index) => {
                const guest = {};
                guest["name"] = name;
                guest["age"] = age_arr[index];
                guests.push(guest);
              });
              console.log(guests);
              // });

              if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
              } else {
                $.ajax({
                  type: "POST",
                  url: "submit_form",
                  contentType: "application/json; charset=utf-8",
                  dataType: "json",
                  data: JSON.stringify({
                    name: $("#name_input").val(),
                    email: $("#email_input").val(),
                    comment: $("#comment_input").val(),
                    is_join: $("#join_toggle").prop("checked"),
                    is_shuttle: $("#shuttle_toggle").prop("checked"),
                    is_food: $("#food_toggle").prop("checked"),
                    is_hotel: $("#hotel_toggle").prop("checked"),
                    shuttle_num: $("#shuttle_num").val(),
                    food_comment: $("#food_comment").val(),
                    hotel_num: $("#hotel_num").val(),
                    guests: guests,
                  }),
                  success: function (response) {
                    console.log("Success!");
                  },
                });
              }

              form.classList.add("was-validated");
            },
            false
          );
        });
      })();
    </script>
  </body>
</html>
